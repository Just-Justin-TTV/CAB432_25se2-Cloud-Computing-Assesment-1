{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Match Resume to Job</title>
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <style>
        #progress-bar {
            transition: width 0.5s ease;
        }
        .match-result {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
<div class="container mt-4">
    <h2>Match Resume to Job</h2>

    <!-- Resume Info -->
    {% if resume %}
        <p><strong>Candidate Name:</strong> {{ resume.candidate_name }}</p>
        <p>
            <strong>Resume:</strong>
            {% if resume.s3_file_path %}
                <a href="{{ resume.s3_file_path }}" target="_blank">View / Download Resume</a>
            {% else %}
                Not available
            {% endif %}
        </p>
        <p><strong>Uploaded At:</strong> {{ resume.uploaded_at }}</p>
    {% else %}
        <p>No resume selected.</p>
    {% endif %}

    <!-- Job Input Form -->
    <form method="post" id="resume-form">
        {% csrf_token %}
        <div class="mb-3">
            <label for="job_position" class="form-label">Job Position</label>
            <input type="text" id="job_position" name="job_position" class="form-control"
                   placeholder="e.g. Data Analyst" required>
        </div>
        <button type="submit" class="btn btn-success">Check AI Match</button>
    </form>

    <!-- Progress Bar -->
    <div class="mt-4">
        <label>AI Generation Progress</label>
        <div class="progress" style="height: 25px;">
            <div id="progress-bar" class="progress-bar bg-success" role="progressbar"
                 style="width: {{ progress|default:0 }}%;">
                {{ progress|default:0 }}%
            </div>
        </div>
    </div>

    <!-- Match Results -->
    <div class="match-result mt-3">
        {% if match_score is not None %}
            <p><strong>Match Score:</strong> {{ match_score }}%</p>
            {% if match_feedback %}
                <p><strong>AI Feedback:</strong> {{ match_feedback }}</p>
            {% endif %}
        {% else %}
            <p>No match data available yet.</p>
        {% endif %}
    </div>
</div>

<script>
function fetchProgress() {
    fetch("{{ task_progress_url }}")
        .then(res => res.json())
        .then(data => {
            const bar = document.getElementById("progress-bar");
            const progress = data.progress !== undefined ? data.progress : 0;
            bar.style.width = progress + "%";
            bar.innerText = progress + "%";
        })
        .catch(err => console.error("Failed to fetch progress:", err));
}

// Poll progress if task_progress_url exists
{% if task_progress_url %}
    setInterval(fetchProgress, 1000);
{% endif %}
</script>
</body>
</html>
